---
import type { CollectionEntry } from "astro:content";
import Pagination from "@/components/Paginator.astro";
import PostPreview from "@/components/blog/PostPreview.astro";
import { getAllPosts, getUniqueTags, groupPostsByYear } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import { collectionDateSort } from "@/utils/date";
import type { GetStaticPaths, Page } from "astro";
import { Icon } from "astro-icon/components";

export const getStaticPaths = (async ({ paginate }) => {
	const MAX_POSTS_PER_PAGE = 10;
	const MAX_TAGS = 7;
	const allPosts = await getAllPosts();
	const uniqueTags = getUniqueTags(allPosts).slice(0, MAX_TAGS);
	return paginate(allPosts.sort(collectionDateSort), {
		pageSize: MAX_POSTS_PER_PAGE,
		props: { uniqueTags },
	});
}) satisfies GetStaticPaths;

interface Props {
	page: Page<CollectionEntry<"post">>;
	uniqueTags: string[];
}

const { page, uniqueTags } = Astro.props;

const meta = {
	description: "Research publications by Shreyas Devaraj",
	title: "Publications",
};

const paginationProps = {
	...(page.url.prev && {
		prevUrl: {
			text: "← Previous Page",
			url: page.url.prev,
		},
	}),
	...(page.url.next && {
		nextUrl: {
			text: "Next Page →",
			url: page.url.next,
		},
	}),
};

const groupedByYear = groupPostsByYear(page.data);
const descYearKeys = Object.keys(groupedByYear).sort((a, b) => +b - +a);
---

<PageLayout meta={meta}>
	<h1 class="title mb-6">Publications</h1>
	<p class="mb-8 text-gray-600 dark:text-gray-400">
		Research publications and academic contributions.
	</p>

	<div class="space-y-8">
		{
			page.data.map((post) => (
				<div class="rounded-lg border border-gray-200 p-6 transition-shadow hover:shadow-lg dark:border-gray-700">
					<div class="mb-4">
						<h2 class="mb-2 text-xl font-semibold text-gray-900 dark:text-gray-100">
							<a
								href="https://ieeexplore.ieee.org/document/10134047"
								target="_blank"
								rel="noopener noreferrer"
								class="hover:text-accent transition-colors"
							>
								{post.data.title}
							</a>
						</h2>

						<p class="mb-1 text-sm text-gray-600 dark:text-gray-400">
							<strong>Conference:</strong> 2023 IEEE International Conference on Inventive
							Computation Technologies (ICICT)
						</p>
						<p class="mb-3 text-sm text-gray-600 dark:text-gray-400">
							<strong>Year:</strong> 2023
						</p>
					</div>

					<p class="mb-4 text-gray-700 dark:text-gray-300">
						{post.data.description}. Achieved 80.13% accuracy on multi-hop questions, outperforming
						BERT on SQuAD and Multi-RC datasets.
					</p>

					<div class="flex items-center gap-4">
						<a
							href="https://ieeexplore.ieee.org/document/10134047"
							target="_blank"
							rel="noopener noreferrer"
							class="text-accent text-sm font-medium hover:underline"
						>
							View Publication →
						</a>
					</div>
				</div>
			))
		}
	</div>

	<Pagination {...paginationProps} />
</PageLayout>
